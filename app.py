# -*- coding: utf-8 -*-
"""éŸ³è¦–è¨Šè¿´è·¯ç›’æŸ¥è©¢ç¶²é 

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1qs92fxnHH6TUu7Dusmk07AjNdDsthmr2
"""

import streamlit as st
import pandas as pd

# ç¶²é åŸºæœ¬è¨­å®šï¼šè¨­ç½®æ¨™é¡Œèˆ‡ä½ˆå±€
st.set_page_config(
    page_title="AV è¿´è·¯ç›’æŸ¥è©¢ç³»çµ±",
    page_icon="ğŸ”",
    layout="wide"
)

# å¥—ç”¨è‡ªå®šç¾© CSS æå‡è³ªæ„Ÿ
st.markdown("""
    <style>
    .main {
        background-color: #f8f9fa;
    }
    .stMetric {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    </style>
    """, unsafe_allow_stdio=True)

# å®šç¾©è®€å–è³‡æ–™çš„å‡½æ•¸ï¼Œä¸¦ä½¿ç”¨å¿«å–é¿å…é‡è¤‡è®€å–
@st.cache_data
def load_data():
    # è®€å–æ‚¨ä¸Šå‚³çš„ CSV æª”æ¡ˆ
    # æ³¨æ„ï¼šæª”æ¡ˆåç¨±å¿…é ˆèˆ‡ GitHub ä¸Šçš„æª”æ¡ˆåç¨±å®Œå…¨ä¸€è‡´
    file_path = "Cable list  éŸ³è¦–è¨Š 20201109.xlsx - è¿´è·¯ç›’.csv"
    try:
        df = pd.read_csv(file_path)
        # è³‡æ–™é è™•ç†ï¼šçµ±ä¸€æœå°‹æ ¼å¼ï¼ˆå¤§å¯«ã€ç§»é™¤ç©ºæ ¼ã€ç§»é™¤æ©«ç·šï¼‰
        df['search_id'] = df['è¿´è·¯ç›’ç·¨è™Ÿ'].astype(str).str.upper().str.replace(' ', '').str.replace('-', '')
        return df
    except Exception as e:
        st.error(f"ç„¡æ³•è®€å–è³‡æ–™æª”æ¡ˆï¼Œè«‹ç¢ºèªæª”åæ˜¯å¦æ­£ç¢ºã€‚éŒ¯èª¤è¨Šæ¯: {e}")
        return None

# åŸ·è¡Œè®€å–è³‡æ–™
df = load_data()

# æ¨™é¡Œå€
st.title("ğŸ“Ÿ éŸ³è¦–è¨Šè¿´è·¯ç›’å¿«é€ŸæŸ¥è©¢ç³»çµ±")
st.markdown("---")

if df is not None:
    # å»ºç«‹æœå°‹åˆ—
    st.subheader("è«‹è¼¸å…¥è¿´è·¯ç›’ç·¨è™Ÿ")
    user_input = st.text_input("æœå°‹ç¯„ä¾‹ï¼šAV 04-01 æˆ–ç›´æ¥è¼¸å…¥ 04-01", placeholder="ä¾‹å¦‚: 04-01")

    if user_input:
        # è™•ç†ä½¿ç”¨è€…è¼¸å…¥çš„é—œéµå­—
        query = user_input.upper().replace(' ', '').replace('-', '')
        if not query.startswith("AV"):
            query = "AV" + query

        # åœ¨è³‡æ–™åº«ä¸­æ¯”å°
        match = df[df['search_id'] == query]

        if not match.empty:
            # å–å¾—è©²ç›’å­çš„ä¸€èˆ¬è³‡è¨Šï¼ˆå–ç¬¬ä¸€ç­†ä½œç‚ºä»£è¡¨ï¼‰
            info = match.iloc[0]

            # ä½¿ç”¨å…©æ¬„ä½ˆå±€é¡¯ç¤ºé‡è¦ä½ç½®è³‡è¨Š
            col1, col2 = st.columns(2)
            with col1:
                st.metric("æ‰€å±¬å»³åˆ¥", info['å»³åˆ¥'].split('\n')[0])
            with col2:
                st.metric("ä½ç½®è©³ç´°", info['è¿´è·¯ç›’ä½ç½®'].replace('\n', ' '))

            st.markdown("---")

            # é¡¯ç¤ºæ¥å£çµ±è¨ˆæ‘˜è¦
            st.subheader("ğŸ“¦ æ¥å£æ•¸é‡åŒ¯ç¸½")
            # ä¾ç…§ç³»çµ±ã€æ¥é ­ã€æ¥é ­å‹å¼é€²è¡Œåˆ†çµ„åŠ ç¸½
            summary = match.groupby(['ç³»çµ±', 'æ¥é ­', 'æ¥é ­å‹å¼'])['æ¥é ­æ•¸'].sum().reset_index()
            summary.columns = ['ç³»çµ±é¡å‹', 'æ¥é ­å‹è™Ÿ', 'å®‰è£/å‹å¼', 'ç¸½æ•¸é‡']
            st.dataframe(summary, use_container_width=True, hide_index=True)

            # é¡¯ç¤ºè©³ç´°ç·šè·¯æ¸…å–®
            with st.expander("ğŸ” é»æ“Šå±•é–‹ï¼šæŸ¥çœ‹æ¯ä¸€æ¢ç·šè·¯çš„æ¨™ç¤ºè™Ÿç¢¼èˆ‡ç›®çš„åœ°"):
                detailed_df = match[['è¿´è·¯æ¨™ç¤ºè™Ÿç¢¼', 'ç·šæ', 'ç›®çš„åœ°æ¨“å±¤', 'æ©Ÿæˆ¿åç¨±', 'æ©Ÿæ«ƒ', 'é»ä½']].copy()
                detailed_df.columns = ['è¿´è·¯æ¨™ç¤º', 'ç·šæå‹è™Ÿ', 'ç›®çš„åœ°æ¨“å±¤', 'æ©Ÿæˆ¿åç¨±', 'æ©Ÿæ«ƒç·¨è™Ÿ', 'é»ä½']
                st.write(detailed_df)
        else:
            st.warning(f"æ‰¾ä¸åˆ°ç·¨è™Ÿã€Œ{user_input}ã€çš„ç›¸é—œè³‡æ–™ï¼Œè«‹æª¢æŸ¥ç·¨è™Ÿæ˜¯å¦æœ‰èª¤ã€‚")
    else:
        # æœªè¼¸å…¥æ™‚çš„æç¤ºç•«é¢
        st.info("ğŸ’¡ æç¤ºï¼šè¼¸å…¥ 4F çš„ç·¨è™Ÿï¼ˆå¦‚ 04-01ï¼‰å¯å¿«é€ŸæŸ¥çœ‹èˆå°å³å´çš„è¨­å‚™ç‹€æ³ã€‚")

        # é¡¯ç¤ºæœ€è¿‘çš„æœå°‹å»ºè­° (é¸é…)
        st.markdown("### å¿«é€Ÿé€£çµ")
        quick_cols = st.columns(4)
        sample_ids = ["AV 04-01", "AV 04-02", "AV 04-03", "AV 04-04"]
        for i, sid in enumerate(sample_ids):
            if quick_cols[i].button(sid):
                st.info(f"è«‹åœ¨æœå°‹æ¡†è¼¸å…¥ {sid} é€²è¡ŒæŸ¥è©¢")

# é å°¾è³‡è¨Š
st.markdown("---")
st.caption("è³‡æ–™ä¾†æºï¼šCable list éŸ³è¦–è¨Š 20201109 | ç³»çµ±æœ€å¾Œæ›´æ–°ï¼š2026-01-06")
